<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>Un libro para ti ✨</title>

  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1230;

      --paper:#F6F2E9;
      --paper2:#FFFDF8;
      --ink:#0B0F1A;

      --radius: 22px;
      --w: min(980px, 94vw);
      --h: min(620px, 72vh);

      --ease: cubic-bezier(.2,.8,.2,1);
      --flipMs: 900ms;

      --accentA: #FF4D6D;
      --accentB: #7C5CFF;
      --accentC: #3CE5D2;
    }

    body{
      margin:0;
      min-height:100svh;
      display:grid;
      place-items:center;
      color: rgba(255,255,255,.92);
      background:
        radial-gradient(1200px 800px at 10% 10%, rgba(124,92,255,.18), transparent 55%),
        radial-gradient(900px 600px at 90% 15%, rgba(60,229,210,.14), transparent 55%),
        radial-gradient(1000px 700px at 50% 90%, rgba(255,77,109,.16), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    body::before{
      content:"";
      position:fixed; inset:-40px;
      background:
        radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,.65), transparent 55%),
        radial-gradient(1px 1px at 80% 30%, rgba(255,255,255,.55), transparent 55%),
        radial-gradient(1px 1px at 25% 75%, rgba(255,255,255,.45), transparent 55%),
        radial-gradient(1px 1px at 55% 45%, rgba(255,255,255,.5), transparent 55%),
        radial-gradient(1.2px 1.2px at 70% 85%, rgba(255,255,255,.35), transparent 55%);
      opacity:.45;
      pointer-events:none;
      transform: translateZ(0);
    }

    .app{
      width: var(--w);
      padding: 18px 14px 26px;
    }

    .topbar{
      display:flex;
      gap: 14px;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 12px;
      user-select:none;
    }
    .logo{
      width: 40px; height: 40px;
      border-radius: 14px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.7), transparent 55%),
        linear-gradient(135deg, rgba(255,77,109,.95), rgba(124,92,255,.95), rgba(60,229,210,.9));
      box-shadow: 0 14px 40px rgba(124,92,255,.25), 0 12px 30px rgba(0,0,0,.25);
      position:relative;
      overflow:hidden;
    }
    .logo::after{
      content:"";
      position:absolute; inset:-40px;
      background: linear-gradient(135deg, transparent, rgba(255,255,255,.25), transparent);
      transform: rotate(20deg);
      animation: shine 5.8s var(--ease) infinite;
    }
    @keyframes shine{
      0%{ transform: translateX(-40%) rotate(20deg); opacity:.0; }
      18%{ opacity:.55; }
      40%{ transform: translateX(55%) rotate(20deg); opacity:.0; }
      100%{ transform: translateX(55%) rotate(20deg); opacity:0; }
    }

    .brand h1{
      margin:0;
      font-size: clamp(16px, 2.2vw, 18px);
      letter-spacing:.2px;
      font-weight: 800;
      line-height:1.05;
    }
    .brand p{
      margin:2px 0 0;
      opacity:.78;
      font-size: 12.5px;
    }

    .controls{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.09);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 25px rgba(0,0,0,.22);
      user-select:none;
    }
    .dot{
      width: 7px; height: 7px; border-radius:50%;
      background: rgba(255,255,255,.55);
      box-shadow: 0 0 0 4px rgba(255,255,255,.10);
    }
    .meta{
      font-size: 12.5px;
      opacity: .9;
      white-space:nowrap;
    }

    button{
      appearance:none;
      border:0;
      padding: 10px 14px;
      border-radius: 12px;
      color: rgba(255,255,255,.94);
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      cursor:pointer;
      transition: transform 180ms var(--ease), background 180ms var(--ease), border-color 180ms var(--ease);
      box-shadow: 0 10px 25px rgba(0,0,0,.22);
      font-weight: 700;
      letter-spacing:.2px;
    }
    button:hover{ transform: translateY(-1px); background: rgba(255,255,255,.14); border-color: rgba(255,255,255,.22); }
    button:active{ transform: translateY(0); }
    button:disabled{ opacity:.45; cursor:not-allowed; transform:none; }

    .stage{
      position:relative;
      width: 100%;
      height: var(--h);
      border-radius: calc(var(--radius) + 8px);
      background: radial-gradient(900px 500px at 50% 0%, rgba(255,255,255,.10), transparent 70%);
      padding: 14px;
    }

    .hint{
      position:absolute;
      left: 14px;
      bottom: 12px;
      font-size: 12px;
      opacity: .75;
      display:flex;
      gap: 8px;
      align-items:center;
      user-select:none;
    }
    .kbd{
      font-size: 11px;
      padding: 4px 7px;
      border-radius: 8px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.16);
    }

    /* ========== BOOK ========== */
    .scene{
      position:absolute;
      inset: 14px;
      border-radius: calc(var(--radius) + 6px);
      display:grid;
      place-items:center;
      perspective: 1800px;
      transform: translateZ(0);
      touch-action: pan-y;
    }

    .book{
      width: min(980px, 100%);
      height: min(610px, 100%);
      position: relative;
      transform-style: preserve-3d;
      filter: drop-shadow(0 28px 80px rgba(0,0,0,.55));
    }

    /* back plate */
    .book::before{
      content:"";
      position:absolute;
      inset: 0;
      border-radius: var(--radius);
      background:
        linear-gradient(90deg,
          rgba(0,0,0,.35),
          rgba(255,255,255,.06) 8%,
          rgba(255,255,255,.04) 50%,
          rgba(255,255,255,.06) 92%,
          rgba(0,0,0,.32));
      box-shadow: 0 28px 80px rgba(0,0,0,.55);
      transform: translateZ(-6px);
    }

    /* stacked paper edge on the right (juicy) */
    .edge{
      position:absolute;
      top: 10px;
      right: 10px;
      bottom: 10px;
      width: 18px;
      border-radius: 14px;
      background:
        repeating-linear-gradient(
          180deg,
          rgba(255,255,255,.55) 0px,
          rgba(255,255,255,.55) 2px,
          rgba(240,233,220,.55) 3px,
          rgba(240,233,220,.55) 5px
        );
      opacity:.55;
      transform: translateZ(2px);
      pointer-events:none;
      filter: blur(.15px);
    }

    .sheets{
      position:absolute;
      inset: 0;
      border-radius: var(--radius);
      transform-style: preserve-3d;
    }

    .sheet{
      position:absolute;
      inset: 0;
      transform-style: preserve-3d;
      transform-origin: left center;
      transition: transform var(--flipMs) var(--ease);
      border-radius: var(--radius);
      will-change: transform;
    }

    /* The actual faces */
    .face{
      position:absolute;
      inset: 0;
      border-radius: var(--radius);
      overflow:hidden;
      backface-visibility: hidden;
      background: linear-gradient(180deg, var(--paper2), var(--paper));
      color: var(--ink);
      box-shadow: 0 18px 44px rgba(0,0,0,.22);
      display:grid;
      grid-template-columns: 1fr 1fr;
    }

    /* make the flip VERY visible with a hinge shadow */
    .sheet::after{
      content:"";
      position:absolute;
      top: 0; bottom: 0;
      left: 0;
      width: 28px;
      border-radius: var(--radius);
      background: radial-gradient(24px 80% at 0% 50%, rgba(0,0,0,.38), transparent 70%);
      opacity: 0;
      transform: translateZ(1px);
      transition: opacity var(--flipMs) var(--ease);
      pointer-events:none;
    }
    .sheet.flipping::after{ opacity: 1; }

    .face.back{
      transform: rotateY(180deg);
    }

    .sheet.flipped{
      transform: rotateY(-180deg);
    }

    .gutter{
      position:absolute;
      top: 0; bottom: 0;
      left: 50%;
      width: 32px;
      transform: translateX(-50%);
      background: radial-gradient(18px 90% at 50% 50%, rgba(0,0,0,.18), transparent 65%);
      pointer-events:none;
      opacity:.95;
      transform-style: preserve-3d;
      translate: 0 0;
    }

    @media (max-width: 740px){
      :root{ --h: min(660px, 78svh); --flipMs: 620ms; }
      .face{ grid-template-columns: 1fr; }
      .gutter{ display:none; }
      .edge{ width: 12px; opacity: .45; }
    }

    /* content blocks */
    .pane{
      padding: clamp(14px, 2.2vw, 22px);
      display:flex;
      flex-direction:column;
      gap: 12px;
      justify-content:space-between;
      min-height: 100%;
      position:relative;
    }

    .hero{
      height: 100%;
      min-height: 250px;
      border-radius: 18px;
      overflow:hidden;
      position:relative;
      background: rgba(0,0,0,.06);
      box-shadow: 0 16px 40px rgba(0,0,0,.12);
    }
    .hero img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      transform: scale(1.02);
      transition: transform 650ms var(--ease);
    }
    .face:hover .hero img{ transform: scale(1.06); }

    .hero::after{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(180deg, transparent 40%, rgba(0,0,0,.25)),
        radial-gradient(60% 45% at 70% 20%, rgba(255,255,255,.22), transparent 60%);
      pointer-events:none;
    }

    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size: 12px;
      font-weight: 780;
      letter-spacing:.35px;
      text-transform: uppercase;
      color: rgba(255,255,255,.94);
      background: linear-gradient(135deg, rgba(255,77,109,.95), rgba(124,92,255,.85));
      padding: 9px 11px;
      border-radius: 999px;
      box-shadow: 0 16px 36px rgba(124,92,255,.22);
      width: fit-content;
      position:absolute;
      left: 14px;
      top: 14px;
    }
    .tag .spark{
      width: 9px; height: 9px; border-radius: 50%;
      background: rgba(255,255,255,.85);
      box-shadow: 0 0 0 6px rgba(255,255,255,.14);
    }

    .title{
      margin: 0;
      font-size: clamp(20px, 2.4vw, 28px);
      line-height: 1.08;
      letter-spacing: .1px;
      font-weight: 880;
    }
    .subtitle{
      margin: 0;
      font-size: 13.5px;
      opacity: .72;
      line-height: 1.35;
    }
    .text{
      margin: 0;
      font-size: clamp(14px, 1.6vw, 15.5px);
      line-height: 1.62;
      color: rgba(10,12,18,.88);
    }

    .footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      margin-top: 6px;
    }
    .pnum{
      font-size: 12px;
      color: rgba(10,12,18,.55);
      font-weight: 800;
      letter-spacing:.2px;
    }
    .mini{
      font-size: 12px;
      color: rgba(10,12,18,.62);
      font-weight: 750;
    }

    /* Cover */
    .cover{
      background:
        radial-gradient(900px 600px at 30% 20%, rgba(124,92,255,.22), transparent 60%),
        radial-gradient(900px 600px at 80% 60%, rgba(60,229,210,.18), transparent 60%),
        linear-gradient(135deg, rgba(255,77,109,.22), rgba(255,255,255,.0) 40%),
        linear-gradient(180deg, #11142B, #090B17);
      color: rgba(255,255,255,.92);
    }
    .cover .text{ color: rgba(255,255,255,.82); }
    .cover .pnum, .cover .mini{ color: rgba(255,255,255,.75); }

    @media (prefers-reduced-motion: reduce){
      .sheet{ transition:none; }
      .logo::after{ animation:none; }
      .face:hover .hero img{ transform:none; }
      .sheet::after{ transition:none; }
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Un libro para ti</h1>
          <p>Una carta interactiva ✦ desliza o usa ← →</p>
        </div>
      </div>

      <div class="controls">
        <div class="pill" title="Estado del libro">
          <span class="dot" aria-hidden="true"></span>
          <div class="meta" id="statusText">Página 1 / 10</div>
        </div>
        <button id="prevBtn" type="button" aria-label="Página anterior">← Atrás</button>
        <button id="nextBtn" type="button" aria-label="Página siguiente">Siguiente →</button>
      </div>
    </div>

    <div class="stage">
      <div class="scene" id="scene">
        <div class="book" role="application" aria-label="Libro interactivo">
          <div class="edge" aria-hidden="true"></div>
          <div class="gutter" aria-hidden="true"></div>
          <div class="sheets" id="sheets"></div>
        </div>
      </div>

      <div class="hint">
        <span class="kbd">←</span><span class="kbd">→</span>
        <span>o swipe para pasar páginas</span>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // CONTENIDO (BOSQUEJO)
    // =========================
    const PAGES = [
      {
        kind: "cover",
        tag: "Capítulo 0",
        title: "Para ti, en forma de libro ✨",
        subtitle: "Un eBook hecho a mano, hoja por hoja, para que lo abras cuando quieras.",
        text: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.",
        image: "https://images.unsplash.com/photo-1520975682071-ae4a9f1e92b1?auto=format&fit=crop&w=1400&q=80"
      },
      {
        tag: "Capítulo 1",
        title: "Una primera página suave",
        subtitle: "Esto es un bosquejo. Después lo llenamos con tu historia real.",
        text: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Amet venenatis urna cursus eget nunc.",
        image: "https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=1400&q=80"
      },
      {
        tag: "Capítulo 1",
        title: "Detalles pequeños, efecto grande",
        subtitle: "Una carta no se lee: se recorre.",
        text: "Eget arcu dictum varius duis at consectetur lorem. Ultrices tincidunt arcu non sodales neque sodales. Ipsum consequat nisl vel pretium lectus quam id leo.",
        image: "https://images.unsplash.com/photo-1516574187841-cb9cc2ca948b?auto=format&fit=crop&w=1400&q=80"
      },
      {
        tag: "Capítulo 2",
        title: "Un recuerdo inventado (por ahora)",
        subtitle: "Aquí después van tus frases reales, tus hitos, tus símbolos.",
        text: "Vitae congue mauris rhoncus aenean vel elit scelerisque mauris pellentesque. Nibh mauris cursus mattis molestie a iaculis. Convallis posuere morbi leo urna molestie.",
        image: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&w=1400&q=80"
      },
      {
        tag: "Capítulo 2",
        title: "Ritmo cómodo",
        subtitle: "Paso de páginas suave, sin marear, con transición elegante.",
        text: "Feugiat sed lectus vestibulum mattis ullamcorper velit sed. Sit amet nisl suscipit adipiscing bibendum est ultricies. Arcu cursus vitae congue mauris rhoncus.",
        image: "https://images.unsplash.com/photo-1520975869012-0f72e6b5f7a8?auto=format&fit=crop&w=1400&q=80"
      },
      {
        tag: "Capítulo 3",
        title: "Una página luminosa",
        subtitle: "Una foto bonita + texto breve siempre pega fuerte.",
        text: "Cras sed felis eget velit aliquet. Sit amet massa vitae tortor condimentum lacinia. Pulvinar etiam non quam lacus suspendisse faucibus interdum posuere.",
        image: "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1400&q=80"
      },
      {
        tag: "Capítulo 3",
        title: "Un mensaje escondido",
        subtitle: "Después puedes meter pistas, cupones, capítulos, sorpresas.",
        text: "Suspendisse potenti nullam ac tortor vitae purus faucibus ornare suspendisse. In hac habitasse platea dictumst vestibulum rhoncus est pellentesque elit.",
        image: "https://images.unsplash.com/photo-1518837695005-2083093ee35b?auto=format&fit=crop&w=1400&q=80"
      },
      {
        tag: "Capítulo 4",
        title: "El estilo ya está",
        subtitle: "Tú reemplazas el contenido y queda listo.",
        text: "Mauris rhoncus aenean vel elit scelerisque mauris pellentesque pulvinar. Malesuada nunc vel risus commodo viverra maecenas accumsan lacus vel facilisis.",
        image: "https://images.unsplash.com/photo-1520975916090-3105956dac38?auto=format&fit=crop&w=1400&q=80"
      },
      {
        tag: "Final",
        title: "Cierre (por ahora)",
        subtitle: "La última página puede ser promesa, invitación o un ‘te elijo’.",
        text: "Amet consectetur adipiscing elit duis tristique sollicitudin nibh sit. Eu feugiat pretium nibh ipsum consequat nisl vel pretium lectus. Nunc sed velit dignissim sodales.",
        image: "https://images.unsplash.com/photo-1520975869012-0f72e6b5f7a8?auto=format&fit=crop&w=1400&q=80"
      },
      {
        tag: "Final",
        title: "Fin ✦",
        subtitle: "Cuando quieras, lo personalizamos completo con tu texto real.",
        text: "Lorem ipsum dolor sit amet. Tempus iaculis urna id volutpat lacus laoreet non. Tellus cras adipiscing enim eu turpis egestas pretium aenean pharetra.",
        image: "https://images.unsplash.com/photo-1516574187841-cb9cc2ca948b?auto=format&fit=crop&w=1400&q=80"
      }
    ];

    // =========================
    // RENDER
    // =========================
    const sheetsEl = document.getElementById("sheets");
    const statusText = document.getElementById("statusText");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const scene = document.getElementById("scene");

    const sheetCount = Math.ceil(PAGES.length / 2);
    let currentSheet = 0; // number of sheets already flipped
    let isAnimating = false;

    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function makeInner(page, pageNumber, isCover=false) {
      const tag = escapeHtml(page?.tag ?? "");
      const title = escapeHtml(page?.title ?? "");
      const subtitle = escapeHtml(page?.subtitle ?? "");
      const text = escapeHtml(page?.text ?? "");
      const image = page?.image ?? "";
      const coverClass = isCover ? "cover" : "";
      const tagHtml = tag ? `<div class="tag"><span class="spark"></span>${tag}</div>` : "";

      return `
        <div class="face ${coverClass}">
          <div class="pane">
            <div style="position:relative;">
              ${tagHtml}
              <div class="hero" aria-hidden="true">
                <img loading="lazy" decoding="async" src="${image}" alt="">
              </div>
            </div>

            <div>
              <h2 class="title">${title}</h2>
              <p class="subtitle">${subtitle}</p>
              <p class="text">${text}</p>

              <div class="footer">
                <span class="mini">Hecho por mí</span>
                <span class="pnum">${pageNumber}</span>
              </div>
            </div>
          </div>

          <!-- right pane (desktop spread) -->
          <div class="pane" aria-hidden="true" style="display:flex; justify-content:center; gap:14px;">
            <div style="
              border-radius:18px;
              background: rgba(0,0,0,.04);
              border: 1px solid rgba(0,0,0,.06);
              padding: 14px;
              box-shadow: 0 16px 40px rgba(0,0,0,.10);
              ">
              <div style="
                width: 100%;
                height: 210px;
                border-radius: 16px;
                background:
                  radial-gradient(120px 90px at 20% 25%, rgba(255,77,109,.25), transparent 60%),
                  radial-gradient(140px 110px at 80% 40%, rgba(124,92,255,.22), transparent 60%),
                  radial-gradient(160px 120px at 40% 80%, rgba(60,229,210,.18), transparent 60%),
                  linear-gradient(180deg, rgba(0,0,0,.05), rgba(0,0,0,.02));
                margin-bottom: 12px;
              "></div>
              <div style="font-weight:880; font-size:16px; color: rgba(10,12,18,.86);">Nota bonita</div>
              <div style="opacity:.72; font-size:13px; line-height:1.5; color: rgba(10,12,18,.82);">
                Aquí puedes poner una frase corta, un mini “te elijo”, o un detalle (fecha, lugar, promesa).
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function buildBook() {
      sheetsEl.innerHTML = "";

      for (let i = 0; i < sheetCount; i++) {
        const frontIndex = i * 2;
        const backIndex = frontIndex + 1;

        const front = PAGES[frontIndex] || null;
        const back = PAGES[backIndex] || null;

        const frontNum = frontIndex + 1;
        const backNum = backIndex + 1;

        const sheet = document.createElement("div");
        sheet.className = "sheet";
        sheet.style.zIndex = String(sheetCount - i); // top sheet highest
        sheet.dataset.index = String(i);

        // FRONT face
        const frontEl = document.createElement("div");
        frontEl.className = "face";
        frontEl.innerHTML = makeInner(front, frontNum, front?.kind === "cover");

        // BACK face
        const backEl = document.createElement("div");
        backEl.className = "face back";
        backEl.innerHTML = makeInner(back, backNum, back?.kind === "cover");

        sheet.appendChild(frontEl);
        sheet.appendChild(backEl);
        sheetsEl.appendChild(sheet);
      }
    }

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function updateUi() {
      const totalPages = PAGES.length;
      const pageNow = clamp(currentSheet * 2 + 1, 1, totalPages);
      statusText.textContent = `Página ${pageNow} / ${totalPages}`;
      prevBtn.disabled = currentSheet === 0 || isAnimating;
      nextBtn.disabled = currentSheet >= sheetCount - 1 || isAnimating;
    }

    function sheets(){ return Array.from(document.querySelectorAll(".sheet")); }

    function animateSheet(sheet, toFlipped) {
      isAnimating = true;
      sheet.classList.add("flipping");
      // Force reflow to ensure class takes effect before transform transition
      void sheet.offsetWidth;

      if (toFlipped) sheet.classList.add("flipped");
      else sheet.classList.remove("flipped");

      const onDone = () => {
        sheet.classList.remove("flipping");
        sheet.removeEventListener("transitionend", onDone);
        isAnimating = false;
        updateUi();
      };
      sheet.addEventListener("transitionend", onDone, { once: true });
      updateUi();
    }

    function goNext() {
      if (isAnimating) return;
      if (currentSheet >= sheetCount - 1) return;
      const s = sheets()[currentSheet];
      animateSheet(s, true);
      currentSheet++;
      updateUi();
    }

    function goPrev() {
      if (isAnimating) return;
      if (currentSheet <= 0) return;
      currentSheet--;
      const s = sheets()[currentSheet];
      animateSheet(s, false);
      updateUi();
    }

    prevBtn.addEventListener("click", goPrev);
    nextBtn.addEventListener("click", goNext);

    window.addEventListener("keydown", (e) => {
      if (e.key === "ArrowRight") goNext();
      if (e.key === "ArrowLeft") goPrev();
    });

    // =========================
    // SWIPE
    // =========================
    let startX = 0, startY = 0, down = false;

    scene.addEventListener("pointerdown", (e) => {
      down = true;
      startX = e.clientX;
      startY = e.clientY;
    });

    scene.addEventListener("pointerup", (e) => {
      if (!down) return;
      down = false;
      const dx = e.clientX - startX;
      const dy = e.clientY - startY;

      if (Math.abs(dy) > Math.abs(dx) * 1.2) return; // vertical intent
      if (dx < -35) goNext();
      if (dx > 35) goPrev();
    });
    scene.addEventListener("pointercancel", () => { down = false; });

    // preload images
    (function preload(){
      for (const p of PAGES) {
        if (!p?.image) continue;
        const img = new Image();
        img.src = p.image;
      }
    })();

    buildBook();
    updateUi();
  </script>
</body>
</html>
