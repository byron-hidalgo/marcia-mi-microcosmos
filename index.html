<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>Una carta para mi microcosmos ✨</title>

  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1230;

      --paper:#F6F2E9;
      --paper2:#FFFDF8;
      --ink:#0B0F1A;

      --radius: 22px;
      --bookW: min(420px, 92vw);
      --bookH: min(760px, 84svh);

      --ease: cubic-bezier(.2,.8,.2,1);
      --flipMs: 820ms;

      --accentA: #FF4D6D;
      --accentB: #7C5CFF;
      --accentC: #3CE5D2;

      /* ✅ NUEVO: control fino del “aire” */
      --spaceSubtitle: 10px; /* separación título -> subtítulo */
      --spaceText: 14px;     /* separación subtítulo -> párrafo */
    }

    body{
      margin:0;
      min-height:100svh;
      display:grid;
      place-items:center;
      color: rgba(255,255,255,.92);
      background:
        radial-gradient(1200px 800px at 10% 10%, rgba(124,92,255,.18), transparent 55%),
        radial-gradient(900px 600px at 90% 15%, rgba(60,229,210,.14), transparent 55%),
        radial-gradient(1000px 700px at 50% 90%, rgba(255,77,109,.16), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    body::before{
      content:"";
      position:fixed; inset:-40px;
      background:
        radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,.65), transparent 55%),
        radial-gradient(1px 1px at 80% 30%, rgba(255,255,255,.55), transparent 55%),
        radial-gradient(1px 1px at 25% 75%, rgba(255,255,255,.45), transparent 55%),
        radial-gradient(1px 1px at 55% 45%, rgba(255,255,255,.5), transparent 55%),
        radial-gradient(1.2px 1.2px at 70% 85%, rgba(255,255,255,.35), transparent 55%);
      opacity:.45;
      pointer-events:none;
      transform: translateZ(0);
    }

    .app{
      width: min(980px, 96vw);
      padding: 16px 12px 24px;
    }

    .topbar{
      display:flex;
      gap: 14px;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 12px;
      user-select:none;
      max-width: 520px;
    }
    .logo{
      width: 40px; height: 40px;
      border-radius: 14px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.7), transparent 55%),
        linear-gradient(135deg, rgba(255,77,109,.95), rgba(124,92,255,.95), rgba(60,229,210,.9));
      box-shadow: 0 14px 40px rgba(124,92,255,.25), 0 12px 30px rgba(0,0,0,.25);
      position:relative;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .logo::after{
      content:"";
      position:absolute; inset:-40px;
      background: linear-gradient(135deg, transparent, rgba(255,255,255,.25), transparent);
      transform: rotate(20deg);
      animation: shine 5.8s var(--ease) infinite;
    }
    @keyframes shine{
      0%{ transform: translateX(-40%) rotate(20deg); opacity:.0; }
      18%{ opacity:.55; }
      40%{ transform: translateX(55%) rotate(20deg); opacity:.0; }
      100%{ transform: translateX(55%) rotate(20deg); opacity:0; }
    }

    .brand h1{
      margin:0;
      font-size: 17px;
      letter-spacing:.2px;
      font-weight: 850;
      line-height:1.05;
    }
    .brand p{
      margin:3px 0 0;
      opacity:.78;
      font-size: 12.5px;
      line-height: 1.25;
    }

    .controls{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.09);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 25px rgba(0,0,0,.22);
      user-select:none;
    }
    .dot{
      width: 7px; height: 7px; border-radius:50%;
      background: rgba(255,255,255,.55);
      box-shadow: 0 0 0 4px rgba(255,255,255,.10);
    }
    .meta{
      font-size: 12.5px;
      opacity: .9;
      white-space:nowrap;
    }

    button{
      appearance:none;
      border:0;
      padding: 10px 14px;
      border-radius: 12px;
      color: rgba(255,255,255,.94);
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      cursor:pointer;
      transition: transform 180ms var(--ease), background 180ms var(--ease), border-color 180ms var(--ease);
      box-shadow: 0 10px 25px rgba(0,0,0,.22);
      font-weight: 750;
      letter-spacing:.2px;
    }
    button:hover{ transform: translateY(-1px); background: rgba(255,255,255,.14); border-color: rgba(255,255,255,.22); }
    button:active{ transform: translateY(0); }
    button:disabled{ opacity:.45; cursor:not-allowed; transform:none; }

    .stage{
      position:relative;
      width: 100%;
      display:grid;
      place-items:center;
      padding: 6px 0 0;
    }

    .hint{
      margin-top: 10px;
      font-size: 12px;
      opacity: .75;
      display:flex;
      gap: 8px;
      align-items:center;
      user-select:none;
      justify-content:center;
    }
    .kbd{
      font-size: 11px;
      padding: 4px 7px;
      border-radius: 8px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.16);
    }

    .scene{
      width: var(--bookW);
      height: var(--bookH);
      border-radius: calc(var(--radius) + 10px);
      background: radial-gradient(900px 500px at 50% 0%, rgba(255,255,255,.10), transparent 70%);
      padding: 14px;
      display:grid;
      place-items:center;
      perspective: 1800px;
      transform: translateZ(0);
      touch-action: pan-y;
    }

    .book{
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      filter: drop-shadow(0 28px 80px rgba(0,0,0,.55));
    }

    .book::before{
      content:"";
      position:absolute;
      inset: 0;
      border-radius: var(--radius);
      background:
        linear-gradient(90deg,
          rgba(0,0,0,.35),
          rgba(255,255,255,.06) 10%,
          rgba(255,255,255,.04) 50%,
          rgba(255,255,255,.06) 90%,
          rgba(0,0,0,.32));
      box-shadow: 0 28px 80px rgba(0,0,0,.55);
      transform: translateZ(-6px);
    }

    .edge{
      position:absolute;
      top: 10px;
      right: 10px;
      bottom: 10px;
      width: 14px;
      border-radius: 14px;
      background:
        repeating-linear-gradient(
          180deg,
          rgba(255,255,255,.55) 0px,
          rgba(255,255,255,.55) 2px,
          rgba(240,233,220,.55) 3px,
          rgba(240,233,220,.55) 5px
        );
      opacity:.55;
      transform: translateZ(2px);
      pointer-events:none;
      filter: blur(.15px);
    }

    .sheets{
      position:absolute;
      inset: 0;
      border-radius: var(--radius);
      transform-style: preserve-3d;
    }

    .sheet{
      position:absolute;
      inset: 0;
      transform-style: preserve-3d;
      transform-origin: left center;
      transition: transform var(--flipMs) var(--ease);
      border-radius: var(--radius);
      will-change: transform;
    }

    .face{
      position:absolute;
      inset: 0;
      border-radius: var(--radius);
      overflow:hidden;
      backface-visibility: hidden;
      background: linear-gradient(180deg, var(--paper2), var(--paper));
      color: var(--ink);
      box-shadow: 0 18px 44px rgba(0,0,0,.22);
      display:flex;
      flex-direction:column;
    }

    .sheet::after{
      content:"";
      position:absolute;
      top: 0; bottom: 0;
      left: 0;
      width: 28px;
      border-radius: var(--radius);
      background: radial-gradient(24px 80% at 0% 50%, rgba(0,0,0,.38), transparent 70%);
      opacity: 0;
      transform: translateZ(1px);
      transition: opacity var(--flipMs) var(--ease);
      pointer-events:none;
    }
    .sheet.flipping::after{ opacity: 1; }

    .face.back{ transform: rotateY(180deg); }
    .sheet.flipped{ transform: rotateY(-180deg); }

    .pane{
      padding: 18px;
      display:flex;
      flex-direction:column;
      gap: 12px;
      min-height: 100%;
      position:relative;
    }

    .hero{
      height: 320px;
      border-radius: 18px;
      overflow:hidden;
      position:relative;
      background: rgba(0,0,0,.06);
      box-shadow: 0 16px 40px rgba(0,0,0,.12);
      flex: 0 0 auto;
    }
    .hero img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
      transform: scale(1.02);
      transition: transform 650ms var(--ease);
    }
    .face:hover .hero img{ transform: scale(1.06); }

    .hero::after{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(180deg, transparent 40%, rgba(0,0,0,.30)),
        radial-gradient(60% 45% at 70% 20%, rgba(255,255,255,.22), transparent 60%);
      pointer-events:none;
    }

    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size: 12px;
      font-weight: 800;
      letter-spacing:.35px;
      text-transform: uppercase;
      color: rgba(255,255,255,.94);
      background: linear-gradient(135deg, rgba(99, 3, 126, 0.95), rgba(156, 131, 255, 0.85));
      padding: 9px 11px;
      border-radius: 999px;
      box-shadow: 0 16px 36px rgba(124,92,255,.22);
      width: fit-content;
      position:absolute;
      left: 16px;
      top: 16px;
      z-index: 2;
    }
    .tag .spark{
      width: 9px; height: 9px; border-radius: 50%;
      background: rgba(255,255,255,.85);
      box-shadow: 0 0 0 6px rgba(255,255,255,.14);
    }

    /* ✅ NUEVO: bloque de texto con justificado */
    .copy{
      text-align: justify;
      text-justify: inter-word;
      hyphens: auto;
      overflow-wrap: break-word;
    }

    .title{
      margin: 0;
      font-size: 24px;
      line-height: 1.08;
      letter-spacing: .1px;
      font-weight: 900;
      /* Si QUIERES el título también “full justificado”, borra esta línea: */
      text-align: left;
    }

    /* ✅ MÁS AIRE entre elementos */
    .subtitle{
      margin: var(--spaceSubtitle) 0 0;
      font-size: 13.5px;
      opacity: .72;
      line-height: 1.35;
    }
    .text{
      margin: var(--spaceText) 0 0;
      font-size: 15.2px;
      line-height: 1.68;
      color: rgba(10,12,18,.88);
    }

    .footer{
      margin-top:auto;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      padding-top: 6px;
    }
    .pnum{
      font-size: 12px;
      color: rgba(10,12,18,.55);
      font-weight: 850;
      letter-spacing:.2px;
    }
    .mini{
      font-size: 12px;
      color: rgba(10,12,18,.62);
      font-weight: 800;
    }

    .cover{
      background:
        radial-gradient(900px 600px at 30% 20%, rgba(124,92,255,.22), transparent 60%),
        radial-gradient(900px 600px at 80% 60%, rgba(60,229,210,.18), transparent 60%),
        linear-gradient(135deg, rgba(255,77,109,.22), rgba(255,255,255,.0) 40%),
        linear-gradient(180deg, #11142B, #090B17);
      color: rgba(255,255,255,.92);
    }
    .cover .text{ color: rgba(255,255,255,.82); }
    .cover .pnum, .cover .mini{ color: rgba(255,255,255,.75); }

    @media (prefers-reduced-motion: reduce){
      .sheet{ transition:none; }
      .logo::after{ animation:none; }
      .face:hover .hero img{ transform:none; }
      .sheet::after{ transition:none; }
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Una carta para mi microcosmos ✨</h1>
          <p>Todo por ti princesa amada ✦ desliza o usa ← →</p>
        </div>
      </div>

      <div class="controls">
        <div class="pill" title="Estado del libro">
          <span class="dot" aria-hidden="true"></span>
          <div class="meta" id="statusText">Página 1 / 5</div>
        </div>
        <button id="prevBtn" type="button" aria-label="Página anterior">← Atrás</button>
        <button id="nextBtn" type="button" aria-label="Página siguiente">Siguiente →</button>
      </div>
    </div>

    <div class="stage">
      <div class="scene" id="scene">
        <div class="book" role="application" aria-label="Libro interactivo">
          <div class="edge" aria-hidden="true"></div>
          <div class="sheets" id="sheets"></div>
        </div>
      </div>

      <div class="hint">
        <span class="kbd">←</span><span class="kbd">→</span>
        <span>o swipe para cambiar páginas</span>
      </div>
    </div>
  </div>

  <script>
    const PAGES = [
      {
        kind: "cover",
        tag: "Capítulo 1",
        title: "Para ti, en forma de librito ✨",
        subtitle: "Porque el amor que siento por ti no cabe en mi.",
        text: "Hace cuatro meses exactamente, un 14 de octubre tuvimos nuestra primera cita, aquella en la que llegaba con nervios y sin imaginar cómo escalaría nuestra historia.",
        image: "images/amarte.jpeg"
      },
      { tag: "", title: "", subtitle: "", text: "", image: "" },

      {
        tag: "Capítulo 2",
        title: "Detalles pequeños, efecto grande",
        subtitle: "Una carta no se lee: se recorre.",
        text: "Eget arcu dictum varius duis at consectetur lorem. Ultrices tincidunt arcu non sodales neque sodales.",
        image: "images/cuidarte.jpeg"
      },
      { tag: "", title: "", subtitle: "", text: "", image: "" },

      {
        tag: "Capítulo 3",
        title: "Ritmo cómodo",
        subtitle: "Paso de páginas suave, sin marear, con transición elegante.",
        text: "Feugiat sed lectus vestibulum mattis ullamcorper velit sed. Sit amet nisl suscipit adipiscing bibendum est ultricies.",
        image: "images/recuerdo.jpeg"
      },
      { tag: "", title: "", subtitle: "", text: "", image: "" },

      {
        tag: "Capítulo 4",
        title: "Un mensaje escondido",
        subtitle: "Después puedes meter pistas, cupones, capítulos, sorpresas.",
        text: "Suspendisse potenti nullam ac tortor vitae purus faucibus ornare suspendisse.",
        image: "images/microcosmos.jpeg"
      },
      { tag: "", title: "", subtitle: "", text: "", image: "" },

      {
        tag: "Capítulo 5",
        title: "Cierre (por ahora)",
        subtitle: "La última página puede ser promesa, invitación o un ‘te elijo’.",
        text: "Amet consectetur adipiscing elit duis tristique sollicitudin nibh sit. Eu feugiat pretium nibh ipsum consequat.",
        image: "images/final.jpeg"
      }
    ];

    const sheetsEl = document.getElementById("sheets");
    const statusText = document.getElementById("statusText");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const scene = document.getElementById("scene");

    const sheetCount = Math.ceil(PAGES.length / 2);
    let currentSheet = 0;
    let isAnimating = false;

    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function hasImage(src) {
      return typeof src === "string" && src.trim().length > 0;
    }

    function makeInner(page, pageNumber) {
      const tag = escapeHtml(page?.tag ?? "");
      const title = escapeHtml(page?.title ?? "");
      const subtitle = escapeHtml(page?.subtitle ?? "");
      const text = escapeHtml(page?.text ?? "");
      const image = page?.image ?? "";
      const tagHtml = tag ? `<div class="tag"><span class="spark"></span>${tag}</div>` : "";

      const heroHtml = hasImage(image)
        ? `
          <div class="hero" aria-hidden="true">
            <img loading="lazy" decoding="async" src="${image}" alt="">
          </div>
        `
        : `
          <div class="hero" aria-hidden="true" style="
            display:grid; place-items:center;
            background:
              radial-gradient(140px 110px at 70% 30%, rgba(124,92,255,.18), transparent 60%),
              radial-gradient(160px 120px at 30% 70%, rgba(255,77,109,.14), transparent 60%),
              linear-gradient(180deg, rgba(0,0,0,.05), rgba(0,0,0,.02));
          ">
            <div style="opacity:.55; font-weight:850;">(Página en blanco)</div>
          </div>
        `;

      return `
        <div class="pane">
          <div style="position:relative;">
            ${tagHtml}
            ${heroHtml}
          </div>

          <!-- ✅ AQUÍ está el bloque “debajo de la imagen” -->
          <div class="copy">
            <h2 class="title">${title}</h2>
            <p class="subtitle">${subtitle}</p>
            <p class="text">${text}</p>
          </div>

          <div class="footer">
            <span class="mini">Hecho por mí</span>
            <span class="pnum">${pageNumber}</span>
          </div>
        </div>
      `;
    }

    function buildBook() {
      sheetsEl.innerHTML = "";

      for (let i = 0; i < sheetCount; i++) {
        const frontIndex = i * 2;
        const backIndex = frontIndex + 1;

        const front = PAGES[frontIndex] || null;
        const back = PAGES[backIndex] || null;

        const frontNum = frontIndex + 1;
        const backNum = backIndex + 1;

        const sheet = document.createElement("div");
        sheet.className = "sheet";
        sheet.dataset.index = String(i);

        sheet.dataset.zFront = String(sheetCount - i);
        sheet.dataset.zBack  = String(i + 1);
        sheet.style.zIndex = sheet.dataset.zFront;

        const frontEl = document.createElement("div");
        frontEl.className = "face" + (front?.kind === "cover" ? " cover" : "");
        frontEl.innerHTML = makeInner(front, frontNum);

        const backEl = document.createElement("div");
        backEl.className = "face back" + (back?.kind === "cover" ? " cover" : "");
        backEl.innerHTML = makeInner(back, backNum);

        sheet.appendChild(frontEl);
        sheet.appendChild(backEl);
        sheetsEl.appendChild(sheet);
      }
    }

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function updateUi() {
      const totalRealPages = sheetCount;
      const pageNow = clamp(currentSheet + 1, 1, totalRealPages);

      statusText.textContent = `Página ${pageNow} / ${totalRealPages}`;
      prevBtn.disabled = currentSheet === 0 || isAnimating;
      nextBtn.disabled = currentSheet >= sheetCount - 1 || isAnimating;
    }

    function sheets(){ return Array.from(document.querySelectorAll(".sheet")); }

    function animateSheet(sheet, toFlipped) {
      if (!sheet) return;

      isAnimating = true;
      prevBtn.disabled = true;
      nextBtn.disabled = true;

      sheet.style.zIndex = "9999";
      sheet.classList.add("flipping");
      void sheet.offsetWidth;

      if (toFlipped) sheet.classList.add("flipped");
      else sheet.classList.remove("flipped");

      let done = false;

      const finish = () => {
        if (done) return;
        done = true;

        sheet.classList.remove("flipping");
        sheet.style.zIndex = toFlipped ? sheet.dataset.zBack : sheet.dataset.zFront;

        isAnimating = false;
        updateUi();
      };

      const onEnd = (e) => {
        if (e && e.propertyName && e.propertyName !== "transform") return;
        sheet.removeEventListener("transitionend", onEnd);
        finish();
      };

      sheet.addEventListener("transitionend", onEnd);

      const ms = parseFloat(getComputedStyle(sheet).transitionDuration) * 1000
               + parseFloat(getComputedStyle(sheet).transitionDelay) * 1000;

      window.setTimeout(() => {
        sheet.removeEventListener("transitionend", onEnd);
        finish();
      }, Math.max(60, Math.round(ms + 120)));
    }

    function goNext() {
      if (isAnimating) return;
      if (currentSheet >= sheetCount - 1) return;

      const all = sheets();
      const s = all[currentSheet];
      if (!s) return;

      animateSheet(s, true);
      currentSheet++;
      updateUi();
    }

    function goPrev() {
      if (isAnimating) return;
      if (currentSheet <= 0) return;

      currentSheet--;
      const all = sheets();
      const s = all[currentSheet];
      if (!s) return;

      animateSheet(s, false);
      updateUi();
    }

    prevBtn.addEventListener("click", goPrev);
    nextBtn.addEventListener("click", goNext);

    window.addEventListener("keydown", (e) => {
      if (e.key === "ArrowRight") goNext();
      if (e.key === "ArrowLeft") goPrev();
    });

    let startX = 0, startY = 0, down = false;

    scene.addEventListener("pointerdown", (e) => {
      down = true;
      startX = e.clientX;
      startY = e.clientY;
    });

    scene.addEventListener("pointerup", (e) => {
      if (!down) return;
      down = false;

      const dx = e.clientX - startX;
      const dy = e.clientY - startY;

      if (Math.abs(dy) > Math.abs(dx) * 1.2) return;
      if (dx < -35) goNext();
      if (dx > 35) goPrev();
    });

    scene.addEventListener("pointercancel", () => { down = false; });

    (function preload(){
      for (const p of PAGES) {
        if (!p?.image || !hasImage(p.image)) continue;
        const img = new Image();
        img.src = p.image;
      }
    })();

    buildBook();
    updateUi();
  </script>
</body>
</html>
